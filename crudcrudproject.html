<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>

</head>

<body>
    <div class="container">
        <form onsubmit="saveToLocalStorage(event)">
            <label for="price" class="form-label">Price :</label>
            <input type="number" name="price" id="price" class="form-control form-control-sm" required>
            <label name = "product" class="form-label">Product:</label>
            <input type="text" name="product" id="product" class="form-control form-control-sm">
            

            
            <button> Submit</button>
        </form>
    </div>
    <ul id='listOfItems'></ul>
    <span style="padding: 0px; margin: 0px;"><b>Total worth of Product: </b>rs </span>
    <span style="padding: 0px; margin: 0px;" id = "total">0</span>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        function saveToLocalStorage(event) {
            event.preventDefault();
            const price = event.target.price.value;
            const product = event.target.product.value;
            
            const Obj = {
                price,
                product
            }
            axios.post("https://crudcrud.com/api/341f412fe3734d0e83d2e89f644d9635/ecommerce",Obj)
                .then((response)=>{
                    showOnScreen(response.data)
                    console.log(response)
                })
                .catch((err)=>{
                    console.log(err);
                })

            
        }


        window.addEventListener("DOMContentLoaded",()=>{
            axios.get("https://crudcrud.com/api/341f412fe3734d0e83d2e89f644d9635/ecommerce")
                .then((response) => {
                    console.log(response);
                    for(var i = 0; i< response.data.length;i++){
                        showOnScreen(response.data[i])
                    }
                })
                .catch((error)=>{
                    console.log(error)
                })
        })
        function showOnScreen(user) {
            document.getElementById('price').value = '';
            document.getElementById('product').value = '';

            const parentNode = document.getElementById('listOfItems');
            const childHTML = `<li id=${user._id}> ${user.price} - ${user.product} 
                                <button onclick=deleteUser('${user._id}','${user.price}')>Delete User</button>
                </li>`
            
                parentNode.innerHTML = parentNode.innerHTML +childHTML;
            const totalparent = document.getElementById('total');
            totalparent.innerHTML = Number(totalparent.innerHTML) + Number(`${user.price}`)
            
        }
        function deleteUser(userId,price){

            axios.delete(`https://crudcrud.com/api/341f412fe3734d0e83d2e89f644d9635/ecommerce/${userId}`)
            .then((response)=>{
                removeUserFromScreen(userId)
            })
            .catch((err)=>{
                console.log(err);
            })
            const parent = document.getElementById('total');
            parent.innerHTML = Number(parent.innerHTML) - Number(price)
        }
        
        function removeUserFromScreen(userId){
          const parentNode = document.getElementById('listOfItems');
          const childElement = document.getElementById(userId)
          if(childElement){
            parentNode.removeChild(childElement)
          }
        }

    </script>
</body>

</html>
